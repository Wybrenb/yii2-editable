/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2017
 * @version   1.7.6
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2015
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},i=function(e,t){e.removeClass(t).addClass(t)},o=function(e,t,i){var o=t+".editable";e.off(o).on(o,i)},a=function(t,i){var o=this;o.$container=e(t),o.init(i),o.destroy(),o.create()};a.prototype={constructor:a,init:function(t){var i=this,o=i.$container;i.$input=o.find(".kv-editable-input"),i.$form=o.find(".kv-editable-form"),i.$value=o.find(".kv-editable-value"),i.$close=o.find(".kv-editable-close"),i.$popover=o.find(".kv-editable-popover"),i.$inline=o.find(".kv-editable-inline"),i.$btnSubmit=o.find("button.kv-editable-submit"),i.$btnReset=o.find("button.kv-editable-reset"),i.$loading=o.find(".kv-editable-loading"),i.$target=o.find(t.target),e.each(t,function(e,t){i[e]=t}),i.initActions()},initActions:function(){var o,a=this,n=a.$form,r=n.parent(),l=a.$container,s=a.$inline,c=a.$loading,u=a.$input,f="",d="",v=n.data("yiiActiveForm"),p=u.closest(".field-"+u.attr("id")),b=p.find(".help-block"),h=u.closest(".kv-editable-parent"),m=a.displayValueConfig,g=n.find('input[name="hasEditable"]'),k=t(p.attr("class"))||t(b.attr("class")),$=h.find(".kv-help-block");o=function(t){k?($.length||($=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(h)),$.html(t).show()):(i(b,"kv-help-block"),b.html(t).show()),i(h,"has-error"),c.hide(),r.removeClass("kv-editable-processing")},a.actions={formReset:function(){setTimeout(function(){n.data("kvEditableSubmit",!1),k?(h.find(".help-block").remove(),h.removeClass("has-error")):(p.removeClass("has-error"),b.html(" ")),a.refreshPopover()},200)},formSubmit:function(e){e.preventDefault()},formChange:function(){a.raise(l,"editableChange",[u.val()])&&a.refreshPopover()},formKeyup:function(e){13===e.which&&a.submitOnEnter&&a.actions.submitClick()},inlineKeyup:function(e){27===e.which&&a.actions.closeClick()},closeClick:function(){a.toggle(!1)},targetClick:function(){var e;return a.asPopover?void a.toggle(!0):(e=!s.is(":visible"),void a.toggle(e))},resetClick:function(){a.raise(l,"editableReset")&&(g.val(0),setTimeout(function(){n[0].reset()},200))},submitClick:function(){var y,C=a.asPopover?r:s,x=!1;i(C,"kv-editable-processing"),c.show(),g.val(1),n.find(".help-block").each(function(){e(this).html("")}),n.find(".has-error").removeClass("has-error"),n.find("input, select").each(function(){var t=e(this),i=t.val(),o=i,n="file"===t.attr("type");x||(x=n),t.attr("disabled")||(n?a.raise(t,"blur"):(e.isArray(i)?o.push("-"):o+="-",t.val(o),a.raise(t,"blur"),t.val(i),a.raise(t,"blur")))}),y={type:n.attr("method"),url:n.attr("action"),dataType:"json",beforeSend:function(e){a.raise(l,"editableBeforeSubmit",[e])||e.abort()},error:function(e,t,i){a.raise(l,"editableAjaxError",[e,t,i])&&a.showAjaxErrors&&o(i)},success:function(i,r,s){return f="",d=t(i.output)?a.htmlEncode(u.val()):i.output,a.refreshPopover(),t(i.message)?(t($.attr("class"))||(p.removeClass("has-error"),$.html("").hide(),b.html("")),n.find(".help-block").each(function(){var i=e(this).text();f+=i?i.trim():"",t(f)||c.hide()}),t(f)?a.raise(l,"editableSuccess",[u.val(),n,i,r,s])&&(c.hide(),t(d)?d=a.valueIfNull:void 0!==m[d]&&(d=m[d]),k?(h.find(".help-block").remove(),h.removeClass("has-error"),b.html(""),a.toggle(!1),a.$value.html(d)):(p.removeClass("has-error"),b.html(""),a.toggle(!1),a.$value.html(d),v&&(n.yiiActiveForm("destroy"),n.yiiActiveForm(v.attributes,v.settings)))):a.raise(l,"editableError",[u.val(),n,i]),void C.removeClass("kv-editable-processing")):void(a.raise(l,"editableError",[u.val(),n,i])&&o(i.message))}},x&&window.FormData?(n.attr("enctype","multipart/form-data"),y.data=new FormData(n[0]),y.contentType=!1,y.processData=!1,y.cache=!1):y.data=n.serialize(),setTimeout(function(){a.raise(l,"editableSubmit",[u.val(),n])&&e.ajax(e.extend(!0,y,a.ajaxSettings))},a.validationDelay)}}},htmlEncode:function(t){var i=this;return i.encodeOutput?("object"==typeof t&&e.each(t,function(e,o){t[e]=i.htmlEncode(o)}),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")):t},toggle:function(e,t){var o=this,a=o.$value,n=o.$inline,r=function(){o.$btnSubmit.focus(),o.selectAllOnEdit&&o.$input.select()};return t=t||"fast",e?o.asPopover?void r():void a.fadeOut(t,function(){n.fadeIn(t,function(){r()}),".kv-editable-button"===o.target&&i(o.$target,"kv-inline-open")}):void(o.asPopover?o.$popover.popoverX("hide"):n.fadeOut(t,function(){a.fadeIn(t),o.$target.removeClass("kv-inline-open")}))},refreshPopover:function(){var e=this;e.asPopover&&e.$popover.popoverX("refreshPosition")},raise:function(t,i,o){var a=e.Event(i);return void 0!==o?t.trigger(a,o):t.trigger(a),!a.isDefaultPrevented()},destroy:function(){var e=this,t=".kv-editable-button"===e.target?e.$target:e.$value;e.$form.off(".editable"),e.$form.find("input, select").off(".editable"),e.$close.off(".editable"),e.$inline.off(".editable"),e.$btnSubmit.off(".editable"),e.$btnReset.off(".editable"),t.off(".editable")},create:function(){var t=this,i=".kv-editable-button"===t.target?t.$target:t.$value;o(t.$form,"reset",e.proxy(t.actions.formReset,t)),o(t.$form,"submit",e.proxy(t.actions.formSubmit,t)),o(t.$form.find("input, select"),"change",e.proxy(t.actions.formChange,t)),o(t.$form,"keyup",e.proxy(t.actions.formKeyup,t)),o(t.$inline,"keyup",e.proxy(t.actions.inlineKeyup,t)),o(t.$btnReset,"click",e.proxy(t.actions.resetClick,t)),o(t.$btnSubmit,"click",e.proxy(t.actions.submitClick,t)),o(t.$close,"click",e.proxy(t.actions.closeClick,t)),o(i,"click",e.proxy(t.actions.targetClick,t))}},e.fn.editable=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var o=e(this),n=o.data("editable"),r="object"==typeof t&&t;n||(n=new a(this,e.extend({},e.fn.editable.defaults,r,e(this).data())),o.data("editable",n)),"string"==typeof t&&n[t].apply(n,i)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0,submitOnEnter:!0,selectAllOnEdit:!0,asPopover:!0,encodeOutput:!0,validationDelay:500},e.fn.editable.Constructor=a}(window.jQuery);